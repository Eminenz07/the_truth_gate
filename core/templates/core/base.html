<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}The Truth Gate{% endblock %}</title>
    <link
      rel="icon"
      href="{% static 'core/img/logo_branding.png' %}"
      type="image/png"
    />
    <link rel="stylesheet" href="{% static 'core/css/theme.css' %}" />
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    {% block extra_css %}{% endblock %}
  </head>
  <body class="{% block body_class %}{% endblock %}">
    <!-- Mobile Header (Sticky Glass) -->
    <header
      class="mobile-header glass-card"
      style="
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-top: none;
      "
    >
      <button class="icon-btn" onclick="toggleMobileMenu()">
        <span class="material-icons-round">menu</span>
      </button>
      <a
        href="{% url 'home' %}"
        class="brand-logo"
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
          text-decoration: none;
        "
      >
        <img
          src="{% static 'core/img/logo_branding.png' %}"
          alt="The Truth Gate"
          style="height: 48px; width: auto"
        />
        <span
          style="
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--text-primary);
          "
          >THE TRUTH GATE</span
        >
      </a>
      <div class="header-actions">
        {% if not user.is_authenticated %}
        <a href="{% url 'login' %}" class="icon-btn"
          ><span class="material-icons-round">account_circle</span></a
        >
        {% endif %}
      </div>
    </header>

    <!-- Desktop Header (Transparent) -->
    <header class="site-header desktop-only">
      <div
        class="container relative"
        style="
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          max-width: 1000px;
        "
      >
        <div style="text-align: left">
          <a
            href="{% url 'home' %}"
            class="logo"
            style="
              margin-bottom: 0;
              display: flex;
              align-items: center;
              gap: 1rem;
              text-decoration: none;
            "
          >
            <img
              src="{% static 'core/img/logo_branding.png' %}"
              alt="The Truth Gate"
              style="height: 64px; width: auto"
            />
            <span
              class="brand-text"
              style="
                font-family: 'Playfair Display', serif;
                font-weight: 700;
                font-size: 1.5rem;
              "
              >The Truth Gate</span
            >
          </a>

        </div>

        <ul
          class="site-nav"
          style="margin: 0; gap: 2rem !important; align-items: center"
        >
          <li><a href="{% url 'home' %}">Home</a></li>
          <li class="dropdown-wrapper">
            <a href="#" class="dropdown-trigger">
              Counseling
              <i
                class="fas fa-chevron-down"
                style="font-size: 0.8rem; margin-left: 4px"
              ></i>
            </a>
            <div class="dropdown-menu glass-card">
              <a href="{% url 'counsel:home' %}">Counsel</a>
              <a href="{% url 'prayer_request' %}">Prayer Requests</a>
              <a href="{% url 'contact' %}">Contact</a>
            </div>
          </li>
          <!-- Placeholder for now -->
          <li><a href="{% url 'event_list' %}">Events</a></li>
          <li><a href="{% url 'give' %}">Donate</a></li>

          <li class="dropdown-wrapper">
            <a href="#" class="dropdown-trigger"
              >Resources
              <i
                class="fas fa-chevron-down"
                style="font-size: 0.8rem; margin-left: 4px"
              ></i
            ></a>
            <div class="dropdown-menu glass-card">
              <a href="{% url 'watch_live' %}">Watch Live</a>
              <!-- Needs Live link -->
              <a href="{% url 'sermon_list' %}">Sermon Library</a>
              <a href="{% url 'testimony_list' %}">Testimonies</a>
            </div>
          </li>

      </div>
    </header>

        <!-- Mobile Floating Toggle -->
    <button class="floating-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Mobile Drawer -->
    <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>
    <nav class="mobile-drawer">
      <div class="drawer-header">
        <span class="brand-text">The Truth Gate</span>
        <button class="close-btn" onclick="toggleMobileMenu()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="drawer-links">
        <a href="{% url 'home' %}" class="drawer-link">Home</a>
        
        <!-- Counseling Dropdown -->
        <div class="drawer-accordion">
          <button class="accordion-trigger" onclick="toggleDrawerAccordion(this)">
            Counseling <i class="fas fa-chevron-down"></i>
          </button>
          <div class="accordion-content">
            <a href="{% url 'counsel:home' %}">Counsel</a>
            <a href="{% url 'prayer_request' %}">Prayer Requests</a>
            <a href="{% url 'contact' %}">Contact</a>
          </div>
        </div>

        <a href="{% url 'event_list' %}" class="drawer-link">Events</a>
        <a href="{% url 'give' %}" class="drawer-link">Donate</a>

        <!-- Resources Dropdown -->
        <div class="drawer-accordion">
          <button class="accordion-trigger" onclick="toggleDrawerAccordion(this)">
            Resources <i class="fas fa-chevron-down"></i>
          </button>
          <div class="accordion-content">
            <a href="{% url 'watch_live' %}">Watch Live</a>
            <a href="{% url 'sermon_list' %}">Sermon Library</a>
            <a href="{% url 'testimony_list' %}">Testimonies</a>
          </div>
        </div>
      </div>
    </nav>

    <main class="site-main">
      {% if messages %}
      <div id="flash-container" style="
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        max-width: 600px;
        width: 90%;
      ">
        {% for message in messages %}
        <div
          class="flash-message"
          style="
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            border-left: 5px solid {% if message.tags == 'success' %}#10b981{% elif message.tags == 'error' %}#ef4444{% else %}var(--accent){% endif %};
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideUp 0.3s ease-out;
          "
        >
          {% if message.tags == 'success' %}
          <span class="material-icons-round" style="color: #10b981">check_circle</span>
          {% elif message.tags == 'error' %}
          <span class="material-icons-round" style="color: #ef4444">error</span>
          {% else %}
          <span class="material-icons-round" style="color: var(--accent)">info</span>
          {% endif %}
          <span style="font-size: 1rem; font-weight: 500;">{{ message }}</span>
        </div>
        {% endfor %}
      </div>
      <style>
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
      </style>
      <script>
        // Auto-dismiss flash messages after 5 seconds
        setTimeout(function() {
          const container = document.getElementById('flash-container');
          if (container) {
            container.style.transition = 'opacity 0.5s ease';
            container.style.opacity = '0';
            setTimeout(() => container.remove(), 500);
          }
        }, 5000);
      </script>
      {% endif %} {% block content %}{% endblock %}
    </main>

    <footer
      class="site-footer"
      style="
        background: var(--bg-body);
        color: var(--text-primary);
        padding: 2rem 1rem;
        border-top: 1px solid var(--border-color);
        font-size: 0.9rem;
      "
    >
      <div
        class="container"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1.5rem;
        "
      >
        <!-- Brand Column -->
        <div>
          <a
            href="{% url 'home' %}"
            style="
              display: flex;
              align-items: center;
              gap: 0.5rem;
              text-decoration: none;
              margin-bottom: 0.75rem;
            "
          >
            <img
              src="{% static 'core/img/logo_branding.png' %}"
              alt="Logo"
              style="height: 40px"
            />
            <span
              style="
                font-family: 'Playfair Display', serif;
                font-weight: 700;
                color: var(--text-primary);
                font-size: 1.1rem;
              "
              >The Truth Gate</span
            >
          </a>
          <p
            style="
              color: var(--text-secondary);
              font-size: 0.85rem;
              line-height: 1.5;
              font-style: italic;
            "
          >
            "Ye shall know the truth and the truth shall set you free." <br>
            <span style="font-style: normal; font-weight: 600; font-size: 0.8rem;">- John 8:32</span>
          </p>
          <div style="display: flex; gap: 0.75rem; margin-top: 0.75rem">
            {% if site_config.facebook_url %}
            <a href="{{ site_config.facebook_url }}" target="_blank" style="color: var(--text-secondary); transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='var(--text-secondary)'">
              <i class="fab fa-facebook"></i>
            </a>
            {% endif %}
            {% if site_config.instagram_url %}
            <a href="{{ site_config.instagram_url }}" target="_blank" style="color: var(--text-secondary); transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='var(--text-secondary)'">
              <i class="fab fa-instagram"></i>
            </a>
            {% endif %}
            {% if site_config.youtube_url %}
            <a href="{{ site_config.youtube_url }}" target="_blank" style="color: var(--text-secondary); transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='var(--text-secondary)'">
              <i class="fab fa-youtube"></i>
            </a>
            {% endif %}
            {% if site_config.x_url %}
            <a href="{{ site_config.x_url }}" target="_blank" style="color: var(--text-secondary); transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='var(--text-secondary)'">
              <i class="fab fa-twitter"></i>
            </a>
            {% endif %}
          </div>
        </div>

        <!-- Quick Links -->
        <div>
          <h4
            style="
              font-family: var(--font-heading);
              margin-bottom: 0.75rem;
              color: var(--primary-dark);
              font-size: 1rem;
            "
          >
            Quick Links
          </h4>
          <ul
            style="
              list-style: none;
              padding: 0;
              display: flex;
              flex-direction: column;
              gap: 0.5rem;
            "
          >
            <li>
              <a
                href="{% url 'home' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Homepage</a
              >
            </li>
            <li>
              <a
                href="#about"
                style="text-decoration: none; color: var(--text-secondary)"
                >About Us</a
              >
            </li>
            <li>
              <a
                href="{% url 'event_list' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Meetings</a
              >
            </li>
            <li>
              <a
                href="{% url 'give' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Donations</a
              >
            </li>
            <li>
              <a
                href="{% url 'prayer_request' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Prayer Requests</a
              >
            </li>
          </ul>
        </div>

        <!-- Community -->
        <div>
          <h4
            style="
              font-family: var(--font-heading);
              margin-bottom: 0.75rem;
              color: var(--primary-dark);
              font-size: 1rem;
            "
          >
            Community
          </h4>
          <ul
            style="
              list-style: none;
              padding: 0;
              display: flex;
              flex-direction: column;
              gap: 0.5rem;
            "
          >
            {% if user.is_authenticated %}
            <li>
              <form action="{% url 'logout' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" style="background:none; border:none; padding:0; color: var(--text-secondary); cursor: pointer; font-family: inherit; font-size: inherit;">Log Out</button>
              </form>
            </li>
            {% else %}
            <li>
              <a
                href="{% url 'login' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Log In</a
              >
            </li>
            <li>
              <a
                href="{% url 'signup' %}"
                style="text-decoration: none; color: var(--text-secondary)"
                >Register</a
              >
            </li>
            {% endif %}
          </ul>
        </div>

        <!-- Subscribe -->
        <div>
          <h4
            style="
              font-family: var(--font-heading);
              margin-bottom: 0.75rem;
              color: var(--primary-dark);
              font-size: 1rem;
            "
          >
            Subscribe Our Newsletter
          </h4>
          <p
            style="
              color: var(--text-secondary);
              font-size: 0.85rem;
              margin-bottom: 0.75rem;
            "
          >
            Get Our Latest Update & News
          </p>
          <form
            action="{% url 'newsletter_subscribe' %}" 
            method="post"
            style="
              display: flex;
              background: white;
              border-radius: 50px;
              padding: 0.2rem;
              border: 1px solid var(--border-color);
            "
          >
            {% csrf_token %}
            <input
              type="email"
              name="email"
              placeholder="Enter your email"
              required
              style="
                border: none;
                padding: 0.5rem 1rem;
                flex-grow: 1;
                border-radius: 50px;
                outline: none;
                background: transparent;
                font-size: 0.9rem;
              "
            />
            <button
              type="submit"
              style="
                background: #10b981;
                color: white;
                border: none;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <i class="fas fa-arrow-right" style="font-size: 0.8rem;"></i>
            </button>
          </form>
        </div>
      </div>

      <div
        class="container"
        style="
          text-align: center;
          margin-top: 2rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--border-color);
        "
      >
        <p style="color: var(--text-secondary); font-size: 0.8rem">
          &copy; {% now "Y" %} The Truth Gate. All Rights Reserved.
        </p>
      </div>
    </footer>

    <!-- Mobile Bottom Navigation (Glass) -->
    <div
      class="bottom-nav glass-card"
      style="
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-bottom: none;
      "
    >
      <a href="{% url 'home' %}" class="nav-item">
        <span class="material-icons-round">home</span>
        <span class="label">Home</span>
      </a>
      <a href="{% url 'sermon_list' %}" class="nav-item">
        <span class="material-icons-round">menu_book</span>
        <span class="label">Sermons</span>
      </a>
      <a href="{% url 'event_list' %}" class="nav-item">
        <span class="material-icons-round">calendar_month</span>
        <span class="label">Events</span>
      </a>
      <a href="{% url 'give' %}" class="nav-item">
        <span class="material-icons-round">favorite</span>
        <span class="label">Give</span>
      </a>
    </div>

    <script>
      function toggleMobileMenu() {
        document.querySelector(".mobile-overlay").classList.toggle("active");
        document.querySelector(".mobile-drawer").classList.toggle("active");
      }

      function toggleDrawerAccordion(trigger) {
          const parent = trigger.parentElement;
          parent.classList.toggle('active');
      }

      // Scroll Reveal Observer
      document.addEventListener("DOMContentLoaded", function () {
        // Fallback: If observer not supported, leave elements visible
        if (!('IntersectionObserver' in window)) return;

        const observerOptions = {
          root: null,
          rootMargin: "0px",
          threshold: 0.1,
        };

        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.remove("pending");
              entry.target.classList.add("active");
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        const revealElements = document.querySelectorAll(".reveal");
        revealElements.forEach((el) => {
           el.classList.add("pending"); // Hide only if JS runs
           observer.observe(el);
        });

        // Auto-dismiss Flash Messages
        setTimeout(function () {
          var messages = document.querySelectorAll('.flash-message');
          messages.forEach(function (msg) {
            msg.style.transition = "opacity 0.5s ease";
            msg.style.opacity = "0";
            setTimeout(function () {
              msg.remove();
            }, 500);
          });
        }, 4000);
      });
    </script>
    
    {% include 'counsel/components/floating_widget.html' %}
  </body>
</html>
