{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<!-- Hero Section -->
<section class="hero text-center fade-in" style="padding: 3rem 1.5rem;">
    <div style="margin-bottom: 1.5rem; opacity: 0.8;">
        <span class="material-icons-round" style="font-size: 48px; color: var(--accent);">church</span>
    </div>
    <h2 style="font-family: var(--font-heading); font-size: 2.5rem; line-height: 1.2; color: #1a1d21; margin-bottom: 0.75rem;">
        Ye shall know the truth
    </h2>
    <p style="font-family: var(--font-heading); font-style: italic; font-size: 1.125rem; color: var(--text-secondary); margin-bottom: 2.5rem; max-width: 300px; margin-left: auto; margin-right: auto;">
        And the truth shall make you free.
    </p>
    <a href="{% url 'sermon_list' %}" class="btn-primary" style="display: block; width: 100%; max-width: 320px; margin: 0 auto; padding: 1rem; text-transform: uppercase; font-size: 0.875rem; letter-spacing: 0.05em; border-radius: 4px; text-decoration: none;">
        Watch Latest Sermon
    </a>
</section>

</section>

<!-- Scroll Nav -->
<section class="mobile-only-section" style="margin-bottom: 2.5rem; border-bottom: 1px solid var(--border-color);">
    <div class="no-scrollbar" style="display: flex; overflow-x: auto; padding: 0 1.5rem; gap: 2rem;">
        <a href="{% url 'home' %}" style="padding-bottom: 0.75rem; font-size: 0.875rem; font-weight: 600; color: var(--accent); border-bottom: 2px solid var(--accent); white-space: nowrap;">Home</a>
        <a href="{% url 'sermon_list' %}" style="padding-bottom: 0.75rem; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); white-space: nowrap;">Sermons</a>
        <a href="{% url 'event_list' %}" style="padding-bottom: 0.75rem; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); white-space: nowrap;">Events</a>
        <a href="{% url 'give' %}" style="padding-bottom: 0.75rem; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); white-space: nowrap;">Give</a>
        <a href="{% url 'prayer_request' %}" style="padding-bottom: 0.75rem; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); white-space: nowrap;">Prayer</a>
    </div>
</section>

<!-- Featured Topics (Cards) -->
<!-- Browse by Topic -->
<section class="container mobile-only-section" style="padding: 0 1.5rem; margin-bottom: 2rem;">
    <h3 style="font-family: var(--font-heading); font-size: 0.8rem; letter-spacing: 0.1em; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem; font-weight: 600;">Browse by Topic</h3>
    
    <!-- Filter Chips -->
    <div class="no-scrollbar" style="display: flex; gap: 0.75rem; overflow-x: auto; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
        <button class="topic-chip active" data-filter="all" onclick="filterTopic('all', this)">All</button>
        {% for cat in categories %}
        <button class="topic-chip" data-filter="{{ cat.slug }}" onclick="filterTopic('{{ cat.slug }}', this)">{{ cat.name }}</button>
        {% endfor %}
    </div>

    <!-- Sermon Feed -->
    <div id="browse-feed" style="display: flex; flex-direction: column; gap: 1rem;">
        {% for sermon in recent_sermons %}
        <div class="sermon-card-mobile fade-in" data-category="{{ sermon.topics.first.slug|default:'uncategorized' }}">
            <div style="margin-bottom: 0.75rem;">
                <span class="category-tag">{{ sermon.topics.first.name|default:"Message" }}</span>
            </div>
            <h4 style="font-family: var(--font-heading); font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--text-primary);">
                <a href="{% url 'sermon_detail' sermon.slug %}" style="text-decoration: none; color: inherit;">{{ sermon.title }}</a>
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; margin-bottom: 1rem;">
                {{ sermon.description|truncatewords:15 }}
            </p>
            
            <div class="action-bar">
                <!-- V2 Logic: Check available media -->
                {% if sermon.video_url %}
                <a href="{% url 'sermon_detail' sermon.slug %}" class="action-link"><i class="fas fa-play"></i> Watch</a>
                <span class="divider">|</span>
                {% endif %}
                
                {% if sermon.audio_file %}
                <a href="{% url 'sermon_detail' sermon.slug %}" class="action-link"><i class="fas fa-headphones"></i> Listen</a>
                <span class="divider">|</span>
                {% endif %}
                
                <a href="{% url 'sermon_detail' sermon.slug %}" class="action-link"><i class="fas fa-align-left"></i> Read</a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div style="text-align: center; margin-top: 1.5rem;">
        <a href="{% url 'sermon_list' %}" class="btn-outline" style="width: 100%; display: block; text-align: center;">View Full Archive &rarr;</a>
    </div>
</section>

<script>
function filterTopic(slug, btn) {
    // Update Active Chip
    document.querySelectorAll('.topic-chip').forEach(el => el.classList.remove('active'));
    btn.classList.add('active');

    // Filter Items
    const items = document.querySelectorAll('.sermon-card-mobile');
    items.forEach(item => {
        if (slug === 'all' || item.dataset.category === slug) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}
</script>

<!-- Testimonies Section -->
<section style="margin: 3rem 1.5rem 2.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1.5rem;">
        <h3 style="font-family: var(--font-heading); font-size: 1.5rem; color: var(--text-primary); margin: 0;">Testimonies</h3>
        <a href="{% url 'submit_testimony' %}" style="font-size: 0.85rem; color: var(--accent); text-decoration: none; font-weight: 500;">Share Yours &rarr;</a>
    </div>

    {% if testimonies %}
        <div style="display: flex; overflow-x: auto; gap: 1rem; padding-bottom: 1rem; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;">
            {% for testimony in testimonies %}
            <div style="flex: 0 0 280px; scroll-snap-align: start; background: #fff; padding: 1.5rem; border: 1px solid var(--border-color); border-radius: 4px; display: flex; flex-direction: column;">
                <p style="font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.5; flex-grow: 1;">"{{ testimony.content|truncatewords:20 }}"</p>
                <div>
                    <strong style="display: block; font-size: 0.9rem; color: var(--text-primary);">{{ testimony.name|default:"Anonymous" }}</strong>
                    {% if testimony.location %}
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">{{ testimony.location }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="background: #f4f6f7; padding: 2rem; border-radius: 8px; text-align: center;">
            <p style="margin-bottom: 1rem; color: var(--text-secondary);">God is moving in our midst. Use your story to encourage others.</p>
            <a href="{% url 'submit_testimony' %}" class="btn-primary" style="display: inline-block; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; font-size: 0.9rem;">Share Your Testimony</a>
        </div>
    {% endif %}
</section>

<!-- Quote Section -->
<section class="mobile-only-section" style="margin: 3rem 1.5rem 2.5rem; padding: 2rem; background: #ffffff; border: 1px solid rgba(90, 112, 121, 0.2); border-radius: 8px; text-align: center;">
    <div class="text-center">
        <span class="material-icons-round" style="color: var(--accent); font-size: 32px; margin-bottom: 1rem;">format_quote</span>
        <p style="font-family: var(--font-heading); font-size: 1.125rem; font-style: italic; color: #1a1d21; margin-bottom: 1.5rem;">
            "The light shines in the darkness, and the darkness has not overcome it."
        </p>
        <p style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-secondary); margin-bottom: 1.5rem;">John 1:5</p>
        
        <form class="subscribe-form" style="display: flex; flex-direction: column; gap: 0.75rem;">
            <input type="email" placeholder="Join our weekly devotional" style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: 4px; text-align: center; font-size: 0.875rem;">
            <button type="button" class="btn-outline">Subscribe</button>
        </form>
    </div>
</section>

<style>
/* Local Styles for Home */
.topic-card {
    background: #ffffff;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1.5rem;
    position: relative;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.card-icon {
    position: absolute;
    top: 1rem;
    right: 1rem;
    opacity: 0.1;
}
.card-icon span { font-size: 48px; color: var(--accent); }

.topic-card h3 {
    font-family: var(--font-heading);
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: #1a1d21;
}

.topic-card p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
    line-height: 1.5;
}

.read-more {
    font-size: 0.75rem;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.05em;
    color: var(--accent);
    display: inline-flex;
    align-items: center;
    gap: 4px;
    text-decoration: none;
}

/* Browse Section Styles */
.topic-chip {
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 500;
    white-space: nowrap;
    border: none;
    background: #f1f3f4;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}
.topic-chip.active {
    background: var(--primary); /* Use primary (Slate) or change to teal if requested */
    color: white;
}

.sermon-card-mobile {
    background: #fff;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 1px 2px rgba(0,0,0,0.02);
}

.category-tag {
    background: #e0f2f1; /* Light teal bg */
    color: #00695c; /* Teal text */
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.action-bar {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #f0f0f0;
}

.action-link {
    font-size: 0.75rem;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--text-light); /* Muted */
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.action-link:hover { color: var(--primary); }

.divider { color: #e0e0e0; font-size: 0.75rem; }

.btn-outline {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-main);
    padding: 0.75rem;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    font-weight: 600;
    border-radius: 4px;
    cursor: pointer;
}
</style>
{% endblock %}
